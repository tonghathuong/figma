<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thanh To√°n - DrinkShop</title>
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  
  <!-- Custom CSS -->
  <link rel="stylesheet" href="css/styles.css">
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçπ</text></svg>">
</head>
<body class="bg-gray-50">
  
  <!-- Navigation Bar -->
  <nav class="ds-navbar fixed w-full top-0 z-50">
    <div class="container mx-auto px-4 py-4">
      <div class="flex items-center justify-between">
        <a href="index.html" class="text-2xl font-bold ds-text-gradient">üçπ DrinkShop</a>
        <div class="flex items-center space-x-4">
          <a href="cart.html" class="text-gray-700 hover:text-green-600 font-medium">‚Üê Quay l·∫°i gi·ªè h√†ng</a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Checkout Section -->
  <section class="pt-32 pb-12">
    <div class="container mx-auto px-4 max-w-6xl">
      <h1 class="text-4xl font-bold text-center mb-12 text-gray-800 ds-fade-in">Thanh To√°n ƒê∆°n H√†ng</h1>

      <form id="checkout-form" onsubmit="return handleCheckout(event)" class="grid lg:grid-cols-3 gap-8">
        
        <!-- Customer Information -->
        <div class="lg:col-span-2 space-y-6">
          
          <!-- Th√¥ng tin ng∆∞·ªùi nh·∫≠n -->
          <div class="bg-white rounded-xl shadow-sm p-6">
            <h2 class="text-2xl font-bold mb-6 text-gray-800">Th√¥ng Tin Ng∆∞·ªùi Nh·∫≠n</h2>
            
            <div class="grid md:grid-cols-2 gap-4">
              <div class="form-group">
                <label class="form-label">H·ªç v√† t√™n *</label>
                <input type="text" id="fullname" name="fullname" required
                       class="form-input" placeholder="Nguy·ªÖn VƒÉn A">
                <div class="error-message hidden" id="fullname-error"></div>
              </div>

              <div class="form-group">
                <label class="form-label">S·ªë ƒëi·ªán tho·∫°i *</label>
                <input type="tel" id="phone" name="phone" required
                       class="form-input" placeholder="0123456789">
                <div class="error-message hidden" id="phone-error"></div>
              </div>

              <div class="form-group md:col-span-2">
                <label class="form-label">Email *</label>
                <input type="email" id="email" name="email" required
                       class="form-input" placeholder="example@email.com">
                <div class="error-message hidden" id="email-error"></div>
              </div>

              <div class="form-group md:col-span-2">
                <label class="form-label">ƒê·ªãa ch·ªâ nh·∫≠n h√†ng *</label>
                <textarea id="address" name="address" required rows="3"
                          class="form-input" placeholder="S·ªë nh√†, t√™n ƒë∆∞·ªùng, ph∆∞·ªùng/x√£, qu·∫≠n/huy·ªán, th√†nh ph·ªë"></textarea>
                <div class="error-message hidden" id="address-error"></div>
              </div>

              <div class="form-group md:col-span-2">
                <label class="form-label">Ghi ch√∫ ƒë∆°n h√†ng (T√πy ch·ªçn)</label>
                <textarea id="notes" name="notes" rows="2"
                          class="form-input" placeholder="V√≠ d·ª•: Giao h√†ng gi·ªù h√†nh ch√≠nh..."></textarea>
              </div>
            </div>
          </div>

          <!-- Ph∆∞∆°ng th·ª©c thanh to√°n -->
          <div class="bg-white rounded-xl shadow-sm p-6">
            <h2 class="text-2xl font-bold mb-6 text-gray-800">Ph∆∞∆°ng Th·ª©c Thanh To√°n</h2>
            
            <div class="space-y-3">
              <label class="flex items-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-green-500 transition">
                <input type="radio" name="payment" value="cod" checked class="mr-3 text-green-600">
                <div class="flex-1">
                  <div class="font-semibold text-gray-800">Thanh to√°n khi nh·∫≠n h√†ng (COD)</div>
                  <div class="text-sm text-gray-600">Thanh to√°n b·∫±ng ti·ªÅn m·∫∑t khi nh·∫≠n h√†ng</div>
                </div>
                <span class="text-2xl">üíµ</span>
              </label>

              <label class="flex items-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-green-500 transition">
                <input type="radio" name="payment" value="bank" class="mr-3 text-green-600">
                <div class="flex-1">
                  <div class="font-semibold text-gray-800">Chuy·ªÉn kho·∫£n ng√¢n h√†ng</div>
                  <div class="text-sm text-gray-600">Chuy·ªÉn kho·∫£n qua ATM/Internet Banking</div>
                </div>
                <span class="text-2xl">üè¶</span>
              </label>

              <label class="flex items-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-green-500 transition">
                <input type="radio" name="payment" value="momo" class="mr-3 text-green-600">
                <div class="flex-1">
                  <div class="font-semibold text-gray-800">V√≠ MoMo</div>
                  <div class="text-sm text-gray-600">Thanh to√°n qua v√≠ ƒëi·ªán t·ª≠ MoMo</div>
                </div>
                <span class="text-2xl">üì±</span>
              </label>

              <label class="flex items-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-green-500 transition">
                <input type="radio" name="payment" value="zalopay" class="mr-3 text-green-600">
                <div class="flex-1">
                  <div class="font-semibold text-gray-800">ZaloPay</div>
                  <div class="text-sm text-gray-600">Thanh to√°n qua v√≠ ƒëi·ªán t·ª≠ ZaloPay</div>
                </div>
                <span class="text-2xl">üí≥</span>
              </label>
            </div>
          </div>

        </div>

        <!-- Order Summary -->
        <div class="lg:col-span-1">
          <div class="bg-white rounded-xl shadow-sm p-6 sticky top-24">
            <h2 class="text-2xl font-bold mb-6 text-gray-800">ƒê∆°n H√†ng</h2>

            <!-- Products -->
            <div id="checkout-items" class="space-y-3 mb-6 max-h-64 overflow-y-auto">
              <!-- S·∫Ω ƒë∆∞·ª£c load b·ªüi JavaScript -->
            </div>

            <!-- Summary -->
            <div class="border-t pt-4 space-y-3">
              <div class="flex justify-between text-gray-600">
                <span>T·∫°m t√≠nh:</span>
                <span id="checkout-subtotal" class="font-semibold">0‚Ç´</span>
              </div>
              <div class="flex justify-between text-gray-600">
                <span>Ph√≠ v·∫≠n chuy·ªÉn:</span>
                <span id="checkout-shipping" class="font-semibold">30.000‚Ç´</span>
              </div>
              <div class="border-t pt-3 flex justify-between text-xl font-bold text-gray-800">
                <span>T·ªïng c·ªông:</span>
                <span id="checkout-total" class="text-green-600">0‚Ç´</span>
              </div>
            </div>

            <!-- Submit Button -->
            <button type="submit" 
                    class="w-full mt-6 bg-green-600 text-white py-4 rounded-lg font-bold text-lg hover:bg-green-700 transition shadow-lg hover:shadow-xl">
              X√°c Nh·∫≠n ƒê·∫∑t H√†ng
            </button>

            <!-- Policy -->
            <div class="mt-6 pt-6 border-t">
              <label class="flex items-start cursor-pointer">
                <input type="checkbox" required class="mt-1 mr-3 text-green-600">
                <span class="text-sm text-gray-600">
                  T√¥i ƒë√£ ƒë·ªçc v√† ƒë·ªìng √Ω v·ªõi 
                  <a href="#" class="text-green-600 hover:underline">ƒëi·ªÅu kho·∫£n v√† ƒëi·ªÅu ki·ªán</a> 
                  c·ªßa website
                </span>
              </label>
            </div>
          </div>
        </div>
      </form>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer py-12">
    <div class="container mx-auto px-4">
      <div class="grid md:grid-cols-4 gap-8 mb-8">
        <div>
          <h3 class="text-xl font-bold mb-4 text-white">DrinkShop</h3>
          <p class="text-gray-400">C·ª≠a h√†ng ƒë·ªì u·ªëng tr·ª±c tuy·∫øn uy t√≠n, ch·∫•t l∆∞·ª£ng cao v·ªõi ƒëa d·∫°ng s·∫£n ph·∫©m.</p>
        </div>

        <div>
          <h4 class="text-lg font-semibold mb-4 text-white">Li√™n K·∫øt</h4>
          <ul class="space-y-2 text-gray-400">
            <li><a href="index.html" class="hover:text-green-400">Trang ch·ªß</a></li>
            <li><a href="products.html" class="hover:text-green-400">S·∫£n ph·∫©m</a></li>
            <li><a href="about.html" class="hover:text-green-400">Gi·ªõi thi·ªáu</a></li>
            <li><a href="contact.html" class="hover:text-green-400">Li√™n h·ªá</a></li>
          </ul>
        </div>

        <div>
          <h4 class="text-lg font-semibold mb-4 text-white">H·ªó Tr·ª£</h4>
          <ul class="space-y-2 text-gray-400">
            <li><a href="#" class="hover:text-green-400">Ch√≠nh s√°ch ƒë·ªïi tr·∫£</a></li>
            <li><a href="#" class="hover:text-green-400">Ch√≠nh s√°ch v·∫≠n chuy·ªÉn</a></li>
            <li><a href="#" class="hover:text-green-400">H∆∞·ªõng d·∫´n ƒë·∫∑t h√†ng</a></li>
            <li><a href="#" class="hover:text-green-400">C√¢u h·ªèi th∆∞·ªùng g·∫∑p</a></li>
          </ul>
        </div>

        <div>
          <h4 class="text-lg font-semibold mb-4 text-white">Li√™n H·ªá</h4>
          <ul class="space-y-2 text-gray-400">
            <li>üìç 182 L√™ Du·∫©n, th√†nh ph·ªë Vinh,Ngh·ªá An.</li>
            <li>üìû 034.742.5997</li>
            <li>‚úâÔ∏è contact@drinkshop.vn</li>
          </ul>
        </div>
      </div>

      <div class="border-t border-gray-700 pt-8 text-center text-gray-400">
        <p>&copy; 2025 DrinkShop. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="js/utils.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/cart.js"></script>
  <script src="js/products.js"></script>
  <script src="js/customeTheme.js"></script>
  
  <script>
    // Kh·ªüi t·∫°o
    document.addEventListener('DOMContentLoaded', function() {
      // Ki·ªÉm tra ƒëƒÉng nh·∫≠p
      if (!isLoggedIn()) {
        showToast('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ ti·∫øp t·ª•c!', 'warning');
        setTimeout(() => {
          window.location.href = 'login.html';
        }, 1500);
        return;
      }

      // Ki·ªÉm tra gi·ªè h√†ng
      const cart = getCart();
      if (cart.length === 0) {
        showToast('Gi·ªè h√†ng tr·ªëng!', 'warning');
        setTimeout(() => {
          window.location.href = 'products.html';
        }, 1500);
        return;
      }

      // Load th√¥ng tin
      loadCheckoutInfo();
    });

    // Load th√¥ng tin checkout
    function loadCheckoutInfo() {
      const cart = getCart();
      const currentUser = getCurrentUser();

      // ƒêi·ªÅn th√¥ng tin user n·∫øu c√≥
      if (currentUser) {
        document.getElementById('fullname').value = currentUser.name || '';
        document.getElementById('email').value = currentUser.email || '';
        document.getElementById('phone').value = currentUser.phone || '';
        document.getElementById('address').value = currentUser.address || '';
      }

      // Hi·ªÉn th·ªã s·∫£n ph·∫©m
      const container = document.getElementById('checkout-items');
      let html = '';
      
      cart.forEach(item => {
        html += `
          <div class="flex items-center space-x-3 pb-3 border-b">
            <img src="${item.image}" alt="${item.name}" class="w-16 h-16 object-cover rounded-lg">
            <div class="flex-1">
              <div class="font-semibold text-sm text-gray-800">${item.name}</div>
              <div class="text-xs text-gray-600">Size ${item.size} √ó ${item.quantity}</div>
            </div>
            <div class="font-bold text-green-600 text-sm">${formatCurrency(item.price * item.quantity)}</div>
          </div>
        `;
      });
      
      container.innerHTML = html;

      // C·∫≠p nh·∫≠t t·ªïng ti·ªÅn
      updateCheckoutSummary();
    }

    // C·∫≠p nh·∫≠t t·ªïng ti·ªÅn
    function updateCheckoutSummary() {
      const total = getCartTotal();
      const shipping = 30000;
      const finalTotal = total + shipping;

      document.getElementById('checkout-subtotal').textContent = formatCurrency(total);
      document.getElementById('checkout-shipping').textContent = formatCurrency(shipping);
      document.getElementById('checkout-total').textContent = formatCurrency(finalTotal);
    }

    // X·ª≠ l√Ω ƒë·∫∑t h√†ng
    function handleCheckout(event) {
      event.preventDefault();

      // Validate form
      if (!validateCheckoutForm()) {
        return false;
      }

      // L·∫•y th√¥ng tin
      const formData = {
        fullname: document.getElementById('fullname').value.trim(),
        phone: document.getElementById('phone').value.trim(),
        email: document.getElementById('email').value.trim(),
        address: document.getElementById('address').value.trim(),
        notes: document.getElementById('notes').value.trim(),
        payment: document.querySelector('input[name="payment"]:checked').value,
        items: getCart(),
        subtotal: getCartTotal(),
        shipping: 30000,
        total: getCartTotal() + 30000,
        orderDate: new Date().toISOString()
      };

      // T·∫°o m√£ ƒë∆°n h√†ng
      const orderId = 'DH' + Date.now();

      // L∆∞u ƒë∆°n h√†ng
      let orders = getLocalStorage('orders') || [];
      orders.push({
        id: orderId,
        ...formData,
        status: 'pending'
      });
      setLocalStorage('orders', orders);

      // X√≥a gi·ªè h√†ng
      clearCart();

      // Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng
      showToast('ƒê·∫∑t h√†ng th√†nh c√¥ng! M√£ ƒë∆°n h√†ng: ' + orderId, 'success');

      // Chuy·ªÉn v·ªÅ trang ch·ªß
      setTimeout(() => {
        window.location.href = 'index.html';
      }, 2000);

      return false;
    }

    // Validate form
    function validateCheckoutForm() {
      let isValid = true;

      // Validate h·ªç t√™n
      const fullname = document.getElementById('fullname').value.trim();
      if (fullname.length < 2) {
        showError('fullname', 'H·ªç t√™n ph·∫£i c√≥ √≠t nh·∫•t 2 k√Ω t·ª±');
        isValid = false;
      } else {
        hideError('fullname');
      }

      // Validate s·ªë ƒëi·ªán tho·∫°i
      const phone = document.getElementById('phone').value.trim();
      if (!isValidPhone(phone)) {
        showError('phone', 'S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá');
        isValid = false;
      } else {
        hideError('phone');
      }

      // Validate email
      const email = document.getElementById('email').value.trim();
      if (!isValidEmail(email)) {
        showError('email', 'Email kh√¥ng h·ª£p l·ªá');
        isValid = false;
      } else {
        hideError('email');
      }

      // Validate ƒë·ªãa ch·ªâ
      const address = document.getElementById('address').value.trim();
      if (address.length < 10) {
        showError('address', 'ƒê·ªãa ch·ªâ ph·∫£i c√≥ √≠t nh·∫•t 10 k√Ω t·ª±');
        isValid = false;
      } else {
        hideError('address');
      }

      if (!isValid) {
        showToast('Vui l√≤ng ki·ªÉm tra l·∫°i th√¥ng tin!', 'error');
      }

      return isValid;
    }

    // Hi·ªÉn th·ªã l·ªói
    function showError(fieldId, message) {
      const input = document.getElementById(fieldId);
      const errorDiv = document.getElementById(fieldId + '-error');
      
      input.classList.add('error');
      errorDiv.textContent = message;
      errorDiv.classList.remove('hidden');
    }

    // ·∫®n l·ªói
    function hideError(fieldId) {
      const input = document.getElementById(fieldId);
      const errorDiv = document.getElementById(fieldId + '-error');
      
      input.classList.remove('error');
      errorDiv.classList.add('hidden');
    }

    // Real-time validation
    ['fullname', 'phone', 'email', 'address'].forEach(fieldId => {
      document.getElementById(fieldId).addEventListener('blur', function() {
        const value = this.value.trim();
        
        if (fieldId === 'fullname' && value.length >= 2) hideError(fieldId);
        if (fieldId === 'phone' && isValidPhone(value)) hideError(fieldId);
        if (fieldId === 'email' && isValidEmail(value)) hideError(fieldId);
        if (fieldId === 'address' && value.length >= 10) hideError(fieldId);
      });
    });
  </script>
</body>
</html>
